<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <title>Fun with Filters and Frequencies!</title>
    <link rel="stylesheet" href="../styles.css">
    <title>Fun with Filters and Frequencies!</title>
    <link rel="icon" type="image/png" href="../icon.png">

</head>

<body>
    <main class="">
        <nav class="navbar navbar-expand-lg py-2 px-xl-5" style="z-index: 100;">
            <div class="container-xxl d-flex align-items-lg-center justify-content-between">
                <a class="navbar-brand" href="https://inst.eecs.berkeley.edu/~cs180/fa24/">CS 180</a>
                <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item ms-lg-3 dropdown">
                            <a class="nav-link link-dark" href="/1/">Project 1</a>
                        </li>
                        <li class="nav-item ms-lg-3">
                            <a class="nav-link link-dark" href="/2/">Project 2</a>
                        </li>
                        <li class="nav-item ms-lg-3">
                            <a class="nav-link link-dark" href="/3/">Project 3</a>
                        </li>
                        <li class="nav-item ms-lg-3">
                            <a class="nav-link link-dark" href="/4/">Project 4</a>
                        </li>
                        <li class="nav-item ms-lg-3">
                            <a class="nav-link link-dark" href="/5/">Project 5</a>
                        </li>
                        <li class="nav-item ms-lg-3">
                            <a class="nav-link link-dark" href="/6/">Final Project</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container legal-text-block">
            <h1 class="text-center">Project 2: <br> Fun with Filters and Frequencies!</h1>
            <hr class="mb-5">
            <p>
                <b>Here is something fun: </b>Look at the image below, it looks like the girl is sticking out her
                tongue, right?
            </p>
            <p>
                But if you look closer and enlarge it by klicking on the image, you will see that she is not actually
                giving you the tongue.
                You can actually even see her lower lip.
            </p>

            <div class="container my-4">
                <img src="data/part1/tongue_final.png" class="img-thumbnail rounded mx-auto d-block" style="width: 25%;"
                    data-bs-toggle="modal" data-bs-target="#imageModal">
            </div>

            <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-body">
                            <img src="data/part1/tongue_final.png" class="img-fluid">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <p>
                Now look at the enlarged image and move away until you almost see her giving you the tongue, but not
                quite.
                If you look at her eyes at this distance, you can see her giving you the tongue from the corner of your
                eyes,
                but if you look at her mouth, her tongue disappears again.
            </p>
            <p>
                This is a fun example of how our brain can be tricked by the frequencies of an image. The image is a
                combination
                of a high-pass and low-pass filter, which we will learn about in this project.
            </p>
            <p>
                Google also just recently released their new Pixel 9 phone, which has <a
                    href="https://store.google.com/intl/en/ideas/articles/pixel-add-me/">the new feature Add Me</a>,
                that gets everyone into a single photo, by combining 2 seperate photos of the same scene.
            </p>
            <p>
                We will learn about how we can lay 2 images on top of each other using a mask, while creating a seamless
                transition between them.
            </p>
            <div class="row row-cols-1 row-cols-md-1 g-4 my-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part1/monies.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <p class="card-text">
                                Here I took 2 pictures of my money and combined them into one image. <br>
                                Now I can show off and pretend that I have 2 monies!
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row row-cols-1 row-cols-md-1 g-4 my-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part1/monies_process.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <p class="card-text">
                                The process of creating the image above. I used a mask to combine the two images.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <p>
                <small>(Please don't use the images of people here anywhere else, thanks!)</small>
            </p>
            <ul>
                <li><a href="#a">1. Fun with filters</a></li>
                <li><a href="#b">2. Fun with Frequencies!</a></li>
                <li><a href="#c">3. My Thoughts on this</a></li>
            </ul>
            <hr class="my-5">
            <a class="anchor" id="a"></a>
            <h3>1. Fun with filters</h3>
            <h4>1.1 Finite Difference Operator</h4>
            <p>
                There is a way to detect edges by looking at the intensity differences of neighboring pixels.
                We can use the Finite difference operator D_x = np.array([[1, -1]])
                <!-- <span class="font-monospace">D_x = np.array([[1, -1]])</span> -->
                and
                <!-- <span class="font-monospace">D_y = np.array([[1], [-1]])</span> -->
                D_y = np.array([[1], [-1]])
                to detect the edges in the x and y direction, by convolving it with the image.
            </p>
            <div class="row row-cols-1 row-cols-md-2 g-4 my-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part1/cameraman.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Cathedral</h5> -->
                            <p class="card-text">Original Image</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row row-cols-1 row-cols-md-2 g-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part1/convoluted_dx.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Tobolsk</h5> -->
                            <p class="card-text">
                                Convoluted with dx, which are basically all the vertical edges
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/part1/convoluted_dy.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Monastery</h5> -->
                            <p class="card-text">
                                Convoluted with dy, which are basically all the horizontal edges
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row row-cols-1 row-cols-md-2 g-4 my-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part1/grad_mag.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Tobolsk</h5> -->
                            <p class="card-text">
                                We get our gradient magnitude image by taking the square root of the sum of the squares
                                of the 2 convoluted dx dy images,
                                like this:
                                grad_mag = np.sqrt(convoluted_dx**2 + convoluted_dy**2)
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/part1/grad_mag_thresh.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Monastery</h5> -->
                            <p class="card-text">
                                To make our image more clear, we can threshold it. We can set a threshold value, and if
                                the gradient magnitude is above this value, we set it to 255 (which is white), else to
                                0.
                                As a threshold I found out that 60 works pretty well for this image.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <h4>1.2 Derivative of Gaussian (DoG) Filter</h4>
            <p>
                The problem here, is that we still see some noise in the images in form of small white dots, which are
                not edges.
                What we could do is to blur the image first, to get rid of the noise. Here I just used a simple Gaussian
                blur with
                a kernel size of 5 and a sigma of 3. I used the blur before running the Finite Difference Operator.
                We can use the following function to create a gaussian kernel:<br>
                gaussian_kernel = cv2.getGaussianKernel(5,3).T * cv2.getGaussianKernel(5,3)

            </p>
            <div class="row row-cols-1 row-cols-md-2 g-4 my-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part1/grad_mag_thresh_blurred.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Tobolsk</h5> -->
                            <p class="card-text">
                                By blurring the image beforehand, we can see that the noise is gone.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/part1/dog_filter_result_thresh.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Monastery</h5> -->
                            <p class="card-text">
                                We can simplify things by using just one convolution instead of two by making a
                                derivative of Gaussian
                                filters by convolving the Gaussian with D_x and D_y.<br>
                                <span style="color:red">Verify that you get the same result as before!</span><br>
                                As we can see, the result with the dog filter is almost the same as before.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <p style="color:red">What differences do you see?</p>
            <p>
                Okay this result is already pretty good. This is because we got rid of the noise that was in the grass
                and
                in some other parts of the image, that was caused by some pixels having a very different intensity then
                its
                surrounding pixels. this has now been cancelled out by blurrying the image a little.
            </p>
            <p>
                What was very important here is that for creating the dog filter kernel, we used the mode full, so that
                no information is lost. Full adds 0 padding, which means, that with our gaussian kernel of size 5x5, if
                we apply the 1x2 D_x kernel on it for convolution, we will pad it on the left and right side with 0
                each, so that it results in a 5x7. After that we apply the convolution with the D_x kernel, so that it
                will end up as a 5x6 dx DoG Kernel. Same with D_y.
            </p>
            <hr class="my-5">
            <a class="anchor" id="b"></a>
            <h3>2. Fun with Frequencies!</h3>
            <h4>2.1 Image "Sharpening"</h4>
            <p>
                We can use frequencies to create any image. The high frequencies often contain the image details whereas
                the lower frequencies
                contain the overall structure of the image. We can increase the high frequencies of an image to sharpen
                an image.
            </p>

            <div class="row row-cols-1 row-cols-md-2 g-4 my-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part2/taj.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Tobolsk</h5> -->
                            <p class="card-text">
                                Our original taj mahal image
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/part2/taj_hf.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Monastery</h5> -->
                            <p class="card-text">
                                This is the high frequency part of the image that we got, by blurring the image with a
                                kernel size of 5 and a sigma of 3,
                                and then subtracting the blurred image from the original image.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row row-cols-1 row-cols-md-2 g-4 my-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part2/taj_sharpened_05.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Tobolsk</h5> -->
                            <p class="card-text">
                                We add the high frequency part to the original image to sharpen it.
                                I use the formula: sharpened = original + alpha * high frequency part
                                Here I have used a alpha of 0.5
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/part2/taj_sharpened_1.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Monastery</h5> -->
                            <p class="card-text">
                                Here I have used a alpha of 1
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row row-cols-1 row-cols-md-2 g-4 my-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part2/taj_sharpened_2.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Tobolsk</h5> -->
                            <p class="card-text">
                                Here I have used a alpha of 2, which is the best result in my opition.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/part2/taj_sharpened_4.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Monastery</h5> -->
                            <p class="card-text">
                                Here I have used a alpha of 4, which feels too much.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <p>
                Lets try it with an image of my choice
            </p>
            <div class="row row-cols-1 row-cols-md-2 g-4 my-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part2/popcorn.webp" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Tobolsk</h5> -->
                            <p class="card-text">
                                Here is our original image. If you find this image confusing, take a closer look, the
                                girl is actually holding a bag of popcorn :D
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/part2/popcorn_sharpened.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Monastery</h5> -->
                            <p class="card-text">
                                Here I have used a alpha of 3. I feel like the bag of popcorn is more visible now.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <p>
                Lets take the taj mahal image again and blur it. We then want to sharpen the blurred image and compare
                it to the original image.
            </p>
            <div class="row row-cols-1 row-cols-md-2 g-4 my-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part2/taj_blurry.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Tobolsk</h5> -->
                            <p class="card-text">
                                We will now use this blurried version of the taj mahal image to sharpen it.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row row-cols-1 row-cols-md-2 g-4 my-4">
                <div class="col">
                    <div class="card">
                        <img src="data/part2/blurried_taj_sharpened.png" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Tobolsk</h5> -->
                            <p class="card-text">
                                This is the result of sharpening our blurried image
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/part2/taj.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <!-- <h5 class="card-title">Monastery</h5> -->
                            <p class="card-text">
                                This is the original image. If we compare the sharpened blurried image to our original
                                image, we can see that
                                the sharpening does not make the image quality better than the original image.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion accordion-flush border-top border-bottom my-3">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faq-heading-1">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#faq1" style="background: none; box-shadow: none;">
                            Normalizing images
                        </button>
                    </h2>
                    <div id="faq1" class="collapse">
                        <div class="accordion-body">
                            To display the images in a more clear way, I normalized the images by dividing the image by
                            subtracting the minimum value of the image and dividing it by the maximum value - the
                            minimum value of the image:<br>
                            final-final.min())/(final.max()-final.min()
                        </div>
                    </div>
                </div>
            </div>

            <h4>2.2 Hybrid Images</h4>
            <p>
                Lets try to create hybrid images as described in this <a
                    href="http://olivalab.mit.edu/publications/OlivaTorralb_Hybrid_Siggraph06.pdf">SIGGRAPH 2006 paper
                    by Oliva, Torralba, and Schyns</a>
                Hybrid images are images that we interpret differently from the distance and from close up, because they
                are a combination of low and high frequencies.
                At a distance, we can only see the low frequencies, and from close up, we can see the high frequencies.
            </p>
            <p>
                We choose 2 images that we want to combine and blur one of them with a gaussian filter to get the low
                frequencies. Here I choose a kernelsize = sigma * 6 + 1 like suggested in the lecture, but added a 1 to it
                because I wanted my gaussian to have a peak in the middle, instead of a flat top.
            </p>
            <p>
                For the derek and nutmeg hybrid image, I set the sigma to 9 and used derek as the low frequency image and
                nutmeg as the high frequency image. Finally, I combined both images by adding the low frequency image to
                the high frequency image and then dividing by 2.
            </p>
            <p>
                All the images were pretty good except for the emir image, of the old gentleman sitting in a chair<br>
                I have also provided the displacement of the green and red plates in regard to the blue plate under each
                image

            </p>
            <div class="row row-cols-1 row-cols-md-1 g-4">
                <div class="col">
                    <div class="card">
                        <img src="data/highres/church_cropped.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">Church</h5>
                            <p class="card-text">Green displacement (x,y): (24 3) <br>
                                Red displacement (x,y): (58 -4)
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/highres/emir.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">Emir</h5>
                            <p class="card-text">Green displacement (x,y): (48 23) <br>
                                Red displacement (x,y): (-100 -48)
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/highres/harvesters.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">Harvesters</h5>
                            <p class="card-text">Green displacement (x,y): (59 19) <br>
                                Red displacement (x,y): (123 16)
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row row-cols-1 row-cols-md-1 g-4">
                <div class="col">
                    <div class="card">
                        <img src="data/highres/icon_cropped.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">Icon</h5>
                            <p class="card-text">Green displacement (x,y): (41 18) <br>
                                Red displacement (x,y): (89 23)
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/highres/lady_cropped.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">Lady</h5>
                            <p class="card-text">Green displacement (x,y): (54 6) <br>
                                Red displacement (x,y): (113 10)
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/highres/melons_cropped.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">Melons</h5>
                            <p class="card-text">Green displacement (x,y): (83 9) <br>
                                Red displacement (x,y): (179 12)
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row row-cols-1 row-cols-md-1 g-4">
                <div class="col">
                    <div class="card">
                        <img src="data/highres/onion_church_cropped.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">Onion Church</h5>
                            <p class="card-text">Green displacement (x,y): (50 26) <br>
                                Red displacement (x,y): (107 37)
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/highres/sculpture_cropped.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">Sculpture</h5>
                            <p class="card-text">Green displacement (x,y): (33 -11) <br>
                                Red displacement (x,y): (140 -27)
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/highres/self_portrait_cropped.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">Self Portrait</h5>
                            <p class="card-text">Green displacement (x,y): (77 29) <br>
                                Red displacement (x,y): (175 37)
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row row-cols-1 row-cols-md-1 g-4">
                <div class="col">
                    <div class="card">
                        <img src="data/highres/three_generations_cropped.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">Three Generations</h5>
                            <p class="card-text">Green displacement (x,y): (49 15) <br>
                                Red displacement (x,y): (109 11)
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <img src="data/highres/train_cropped.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">Train</h5>
                            <p class="card-text">Green displacement (x,y): (42 6) <br>
                                Red displacement (x,y): (85 32)
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <a class="anchor" id="c"></a>
            <hr class="my-5">
            <h3>3. My Thoughts on this</h3>
            <p>
                While this yields good results, we still have one image, which is not alligned well. Despite using an
                image pyramid,
                it is still very compute intensive to compare each individual pixel intensity.
            </p>
            <p>
                To better and more efficiently allign the images we should consider some structural hints like edges,
                for which we can use
                the simple sobel operator.
            </p>
        </div>


    </main>
    <footer class="my-3">
        <div class="container-lg">
            <hr>
            <div style="font-size: .75rem">
                <div class="text-muted">Thanks for enrolling me in the course 🌱</div>
            </div>
        </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>


    </script>
</body>

</html>